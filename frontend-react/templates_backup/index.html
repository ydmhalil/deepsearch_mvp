{% extends "base.html" %}

{% block title %}DeepSearch Enterprise | Kurumsal Doküman Arama Sistemi{% endblock %}

{% block extra_css %}
<style>
    /* Hero Section */
    .hero-section {
        background: var(--primary-gradient);
        color: white;
        padding: 4rem 0;
        position: relative;
        overflow: hidden;
    }
    
    .hero-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        opacity: 0.3;
    }
    
    .hero-content {
        position: relative;
        z-index: 2;
    }
    
    .company-logo {
        width: 64px;
        height: 64px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: var(--space-lg);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .search-section {
        background: var(--neutral-50);
        padding: var(--space-3xl) 0;
    }
    
    .feature-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: var(--space-xl);
    }
    
    .feature-icon {
        width: 72px;
        height: 72px;
        background: var(--primary-gradient);
        border-radius: var(--radius-xl);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto var(--space-lg);
        color: white;
        font-size: 1.75rem;
        box-shadow: var(--shadow-lg);
    }
    
    .quick-actions {
        display: flex;
        gap: var(--space-sm);
        flex-wrap: wrap;
        justify-content: center;
        margin-top: var(--space-lg);
    }
    
    .search-suggestions {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid var(--neutral-200);
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-xl);
        z-index: var(--z-dropdown);
        max-height: 200px;
        overflow-y: auto;
    }
    
    .suggestion-item {
        padding: var(--space-md) var(--space-lg);
        cursor: pointer;
        border-bottom: 1px solid var(--neutral-100);
        transition: var(--transition-fast);
        display: flex;
        align-items: center;
        gap: var(--space-sm);
    }
    
    .suggestion-item:hover {
        background: var(--neutral-50);
        color: var(--primary-color);
    }
    
    .suggestion-item:last-child {
        border-bottom: none;
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <div class="hero-content">
                    <div class="company-logo">
                        <i class="bi bi-search" style="color: white; font-size: 2rem;"></i>
                    </div>
                    <h1 class="display-4 fw-bold mb-3">
                        Kurumsal Doküman <br>
                        <span style="color: rgba(255, 255, 255, 0.9);">Arama Sistemi</span>
                    </h1>
                    <p class="lead mb-4" style="color: rgba(255, 255, 255, 0.85);">
                        Enterprise-grade belge arama ve analiz platformu. 
                        Yapay zeka destekli semantik arama ile kurumsal bilgi varlıklarınızı
                        anında keşfedin ve yönetin.
                    </p>
                    <div class="d-flex gap-3 flex-wrap">
                        <a href="#search-section" class="btn btn-unified btn-unified-secondary">
                            <i class="bi bi-search me-2"></i>Aramaya Başla
                        </a>
                        <a href="{{ url_for('upload_page') }}" class="btn btn-unified btn-unified-secondary" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); color: white;">
                            <i class="bi bi-upload me-2"></i>Doküman Yükle
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="text-center">
                    <div class="row g-3">
                        <div class="col-6">
                            <div class="stats-card" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px);">
                                <div class="stats-number" style="color: white;">1000+</div>
                                <div class="stats-label" style="color: rgba(255, 255, 255, 0.8);">Doküman Kapasitesi</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stats-card" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px);">
                                <div class="stats-number" style="color: white;">100+</div>
                                <div class="stats-label" style="color: rgba(255, 255, 255, 0.8);">Eşzamanlı Kullanıcı</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Search Section -->
<section id="search-section" class="search-section">
    <div class="container">
        <div class="page-header text-center">
            <h2>Gelişmiş Doküman Arama</h2>
            <p>Yapay zeka destekli semantik arama ile istediğiniz bilgiyi anında bulun</p>
        </div>
        
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card-unified">
                    <div class="card-body">
                        <form action="{{ url_for('do_search') }}" method="post" id="searchForm">
                            <div class="row g-3 mb-4">
                                <div class="col-lg-8">
                                    <div class="position-relative">
                                        <input type="text" 
                                               name="query" 
                                               id="searchQuery"
                                               class="form-control-unified" 
                                               placeholder="Aradığınız konu, belge türü veya içerik..."
                                               style="font-size: 1.1rem; padding: 1rem 1.25rem;"
                                               autocomplete="off"
                                               required>
                                        <div id="searchSuggestions" class="search-suggestions" style="display: none;"></div>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <button type="submit" class="btn btn-unified btn-unified-primary w-100 h-100" style="font-size: 1.1rem;">
                                        <i class="bi bi-search me-2"></i>Arama Yap
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Advanced Filters -->
                            <div class="text-center mb-3">
                                <button type="button" class="btn btn-unified btn-unified-secondary btn-sm" 
                                        data-bs-toggle="collapse" data-bs-target="#advancedFilters">
                                    <i class="bi bi-funnel me-2"></i>Gelişmiş Filtreler
                                </button>
                            </div>
                            
                            <div class="collapse" id="advancedFilters">
                                <div class="card-unified" style="background: var(--neutral-50);">
                                    <div class="card-body">
                                        <div class="row g-4">
                                            <div class="col-md-4">
                                                <label class="form-label fw-semibold">Dosya Formatı</label>
                                                <div class="d-flex flex-wrap gap-3">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" name="file_types" value="pdf" id="type_pdf">
                                                        <label class="form-check-label" for="type_pdf">PDF</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" name="file_types" value="docx" id="type_docx">
                                                        <label class="form-check-label" for="type_docx">DOCX</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" name="file_types" value="xlsx" id="type_xlsx">
                                                        <label class="form-check-label" for="type_xlsx">XLSX</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" name="file_types" value="txt" id="type_txt">
                                                        <label class="form-check-label" for="type_txt">TXT</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label fw-semibold">Tarih Aralığı</label>
                                                <div class="row g-2">
                                                    <div class="col-6">
                                                        <input type="date" class="form-control-unified" name="date_from" placeholder="Başlangıç">
                                                    </div>
                                                    <div class="col-6">
                                                        <input type="date" class="form-control-unified" name="date_to" placeholder="Bitiş">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label fw-semibold">Ek Seçenekler</label>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" name="indexed_only" value="1" id="indexed_only">
                                                    <label class="form-check-label" for="indexed_only">
                                                        Sadece indekslenmiş dosyalar
                                                    </label>
                                                </div>
                                                {% if current_user and current_user.role != 'admin' %}
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" name="user_files_only" value="1" id="user_files_only">
                                                    <label class="form-check-label" for="user_files_only">
                                                        Sadece kendi dosyalarım
                                                    </label>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Quick Actions -->
                            <div class="quick-actions">
                                <button type="button" class="btn btn-unified btn-unified-secondary btn-sm" onclick="clearFilters()">
                                    <i class="bi bi-arrow-clockwise me-1"></i>Temizle
                                </button>
                                <a href="{{ url_for('search_history_page') }}" class="btn btn-unified btn-unified-secondary btn-sm">
                                    <i class="bi bi-clock-history me-1"></i>Arama Geçmişi
                                </a>
                                <button type="button" class="btn btn-unified btn-unified-secondary btn-sm" onclick="saveCurrentSearch()">
                                    <i class="bi bi-bookmark me-1"></i>Aramayı Kaydet
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Features Section -->
<section class="py-5">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="fw-bold">Kurumsal Özellikler</h2>
            <p class="text-muted lead">Enterprise-grade doküman yönetimi ve arama çözümleri</p>
        </div>
        
        <div class="feature-grid">
            <div class="card-unified text-center">
                <div class="card-body">
                    <div class="feature-icon">
                        <i class="bi bi-shield-check"></i>
                    </div>
                    <h4 class="fw-bold mb-3">Güvenli & Lokal</h4>
                    <p class="text-muted mb-3">
                        Tüm veriler yerel sunucularınızda saklanır. 
                        Enterprise-grade güvenlik ve gizlilik koruması.
                    </p>
                </div>
            </div>
            
            <div class="card-unified text-center">
                <div class="card-body">
                    <div class="feature-icon">
                        <i class="bi bi-robot"></i>
                    </div>
                    <h4 class="fw-bold mb-3">AI Chat Assistant</h4>
                    <p class="text-muted mb-3">
                        Belgelerinizle konuşun! RAG teknolojisi ile 
                        doğal dil sorularına akıllı yanıtlar alın.
                    </p>
                    <a href="{{ url_for('rag_chat') }}" class="btn btn-unified btn-unified-primary btn-sm">
                        <i class="bi bi-chat-dots me-1"></i>Chat'i Dene
                    </a>
                </div>
            </div>
            
            <div class="card-unified text-center">
                <div class="card-body">
                    <div class="feature-icon">
                        <i class="bi bi-files"></i>
                    </div>
                    <h4 class="fw-bold mb-3">Çoklu Format</h4>
                    <p class="text-muted mb-3">
                        PDF, DOCX, XLSX, PPTX, TXT dosyalarını 
                        destekler. OCR ile taranmış belgeleri okur.
                    </p>
                </div>
            </div>
            
            <div class="card-unified text-center">
                <div class="card-body">
                    <div class="feature-icon">
                        <i class="bi bi-graph-up"></i>
                    </div>
                    <h4 class="fw-bold mb-3">Gelişmiş Analitik</h4>
                    <p class="text-muted mb-3">
                        Arama istatistikleri, doküman insights ve 
                        kurumsal raporlama araçları.
                    </p>
                    <a href="{{ url_for('kobi_dashboard') }}" class="btn btn-unified btn-unified-primary btn-sm">
                        <i class="bi bi-chart-line me-1"></i>Dashboard
                    </a>
                </div>
            </div>
            
            <div class="card-unified text-center">
                <div class="card-body">
                    <div class="feature-icon">
                        <i class="bi bi-people"></i>
                    </div>
                    <h4 class="fw-bold mb-3">Multi-User</h4>
                    <p class="text-muted mb-3">
                        Çoklu kullanıcı desteği, rol bazlı erişim 
                        kontrolü ve takım çalışması özellikleri.
                    </p>
                </div>
            </div>
            
            <div class="card-unified text-center">
                <div class="card-body">
                    <div class="feature-icon">
                        <i class="bi bi-speedometer2"></i>
                    </div>
                    <h4 class="fw-bold mb-3">Yüksek Performans</h4>
                    <p class="text-muted mb-3">
                        Enterprise-grade veritabanı optimizasyonu 
                        ile milisaniyede sonuç alın.
                    </p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Stats Section -->
<section class="py-5" style="background: white; border-top: 1px solid var(--neutral-200);">
    <div class="container">
        <div class="row text-center">
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number">📁 {{ stats.total_documents if stats else '10' }}</div>
                    <div class="stats-label">Toplam Doküman</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number">🔍 {{ stats.total_searches if stats else '150' }}</div>
                    <div class="stats-label">Toplam Arama</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number">👥 {{ stats.active_users if stats else '5' }}</div>
                    <div class="stats-label">Aktif Kullanıcı</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number">⚡ 99.9%</div>
                    <div class="stats-label">Sistem Çalışma Oranı</div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    // Search functionality
    document.addEventListener('DOMContentLoaded', function() {
        const searchQuery = document.getElementById('searchQuery');
        const searchSuggestions = document.getElementById('searchSuggestions');
        let searchTimeout;

        // Search suggestions
        searchQuery.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            const query = this.value.trim();
            
            if (query.length >= 2) {
                searchTimeout = setTimeout(() => {
                    fetchSearchSuggestions(query);
                }, 300);
            } else {
                searchSuggestions.style.display = 'none';
            }
        });

        function fetchSearchSuggestions(query) {
            fetch(`/search_suggestions?q=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    displaySuggestions(data.suggestions || []);
                })
                .catch(error => {
                    console.error('Search suggestions error:', error);
                });
        }

        function displaySuggestions(suggestions) {
            if (suggestions.length === 0) {
                searchSuggestions.style.display = 'none';
                return;
            }

            searchSuggestions.innerHTML = suggestions.map(suggestion => 
                `<div class="suggestion-item" onclick="selectSuggestion('${suggestion}')">
                    <i class="bi bi-search text-muted"></i>
                    ${suggestion}
                </div>`
            ).join('');
            
            searchSuggestions.style.display = 'block';
        }

        // Hide suggestions when clicking outside
        document.addEventListener('click', function(event) {
            if (!searchQuery.contains(event.target) && !searchSuggestions.contains(event.target)) {
                searchSuggestions.style.display = 'none';
            }
        });

        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    });

    // Utility functions
    function selectSuggestion(suggestion) {
        document.getElementById('searchQuery').value = suggestion;
        document.getElementById('searchSuggestions').style.display = 'none';
        document.getElementById('searchForm').submit();
    }

    function clearFilters() {
        document.getElementById('searchQuery').value = '';
        document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
        document.querySelectorAll('input[type="date"]').forEach(input => input.value = '');
    }

    function saveCurrentSearch() {
        const query = document.getElementById('searchQuery').value.trim();
        if (!query) {
            showToast('Önce bir arama yapın', 'warning');
            return;
        }

        const name = prompt('Bu aramaya bir isim verin:');
        if (!name || !name.trim()) {
            return;
        }

        fetch('/save_search', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                name: name.trim(),
                query: query
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showToast('Arama başarıyla kaydedildi!', 'success');
            } else {
                showToast('Hata: ' + data.message, 'error');
            }
        })
        .catch(error => {
            console.error('Save search error:', error);
            showToast('Kaydetme sırasında hata oluştu', 'error');
        });
    }
</script>
{% endblock %}
